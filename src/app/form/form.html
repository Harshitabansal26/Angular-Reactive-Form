<div class="form-container">
  <form [formGroup]="applicationForm">
    <h1 *ngIf="!reviewMode" class="page-heading">
  <span class="main-title">Business Onboarding</span>
  <span class="separator"> &gt; </span>
  <span class="sub-title">Add New Application</span>
</h1>

<h1 *ngIf="reviewMode" class="review-heading">Review Form Page</h1>

    <!-- Product Section -->
    <div class="form-section">
      <h2>Product or service applying for </h2>
      <div class="form-group required">
        <!-- <label>Product or service applying for</label> -->
        <div class="checkbox-group" formArrayName="product">
          <div *ngFor="let option of productOptions; let i = index" class="checkbox-item">
            <input type="checkbox" [formControlName]="i" [id]="option.value" />
            <label [for]="option.value">{{ option.name }}</label>
          </div>
        </div>
        <div *ngIf="productFormArray.invalid && productFormArray.touched" class="error-message">
          Please select at least one product.
        </div>
      </div>
    </div>
    <!-- Application Source -->
    <div class="form-section">
         
      <div class="form-group required">
        <label for="applicationSource">Application Received From</label>
          <select id="applicationSource" formControlName="applicationSource">
            <option value="">Select...</option>
            <option *ngFor="let source of lookupData.applicationReceiveFrom" [value]="source.key"> {{ source.value }} </option> 
            </select>
            <div *ngIf="applicationForm.get('applicationSource')?.touched && applicationForm.get('applicationSource')?.invalid" class="error-message"> Please select an option.
            </div>
        </div>
    </div>
    <!-- Residency + Retailer -->
<div class="form-section" formGroupName="personalDetails">
  <div class="form-row row-2">

    <!-- Jamaica Resident -->
    <div class="form-group required">
      <label class="highlight-label"> Are you a Jamaica Resident? </label>
      <div class="radio-group">
        <div class="radio-item">
          <input type="radio" id="jamaica-yes" value="YES" formControlName="isJamaicaResident" />
          <label for="jamaica-yes">Yes</label>
        </div>
        <div class="radio-item">
          <input type="radio" id="jamaica-no" value="NO" formControlName="isJamaicaResident" />
          <label for="jamaica-no">No</label>
        </div>
      </div>
      <div *ngIf="personalDetails.get('isJamaicaResident')?.touched && personalDetails.get('isJamaicaResident')?.invalid" class="error-message">
        Please select an option.
      </div>
    </div>

    <!-- Existing Retailer -->
    <div class="form-group required">
      <label class="highlight-label">Are you an existing Retailer?</label>
      <div class="radio-group">
        <div class="radio-item">
          <input type="radio" id="retailer-yes" value="YES" formControlName="existingRetailer" (change)="onExistingRetailerChange($event)" />
          <label for="retailer-yes">Yes</label>
        </div>
        <div class="radio-item">
          <input type="radio" id="retailer-no" value="NO" formControlName="existingRetailer" (change)="onExistingRetailerChange($event)" />
          <label for="retailer-no">No</label>
        </div>
      </div>

      <!-- Conditional Retailer ID input -->
      <div *ngIf="personalDetails.get('existingRetailer')?.value === 'YES'" class="retailer-id-input">
        <label for="retailerId" class="highlight-label">Retailer ID</label>
        <input type="text" id="retailerId" formControlName="retailerId" />
        <div *ngIf="personalDetails.get('retailerId')?.touched && personalDetails.get('retailerId')?.invalid" class="error-message">
          Please enter the Retailer ID.
        </div>
      </div>
    </div>

  </div>
</div>

    <!-- Personal Details -->
    <div class="form-section" formGroupName="personalDetails">
      <h2>Personal Details</h2>

      <!-- Row 1: Title + Names + DOB -->
      <div class="form-row row-5">
        <div class="form-group required">
          <label for="title">Title</label>
          <select id="title" formControlName="title">
            <option value="">Select...</option>
            <option *ngFor="let t of lookupData.title" [value]="t.key">{{ t.value }}</option>
          </select>
          <div *ngIf="personalDetails.get('title')?.touched && personalDetails.get('title')?.invalid" class="error-message">
            Please select an option.
          </div>
        </div>

        <div class="form-group required">
          <label for="firstName">First Name</label>
          <input id="firstName" type="text" formControlName="firstName" />
          <div *ngIf="personalDetails.get('firstName')?.touched && personalDetails.get('firstName')?.invalid" class="error-message">
            Please fill this field.
          </div>
        </div>

        <div class="form-group">
          <label for="middleName">Middle Name</label>
          <input id="middleName" type="text" formControlName="middleName" />
        </div>

        <div class="form-group required">
          <label for="lastName">Last Name</label>
          <input id="lastName" type="text" formControlName="lastName" />
          <div *ngIf="personalDetails.get('lastName')?.touched && personalDetails.get('lastName')?.invalid" class="error-message">
            Please fill this field.
          </div>
        </div>
        <div class="form-group required">
  <label for="email">Email</label>
  <input id="email" type="email" formControlName="email" />
  <div *ngIf="personalDetails.get('email')?.touched && personalDetails.get('email')?.invalid" class="error-message">
    Please enter a valid email.
  </div>
</div>
</div>
<br>
        <!-- Row: DOB + Phones -->
<div class="form-row row-4">
  <div class="form-group required">
    <label for="dateOfBirth">Date of Birth</label>
    <input id="dateOfBirth" type="date" formControlName="dateOfBirth" />
    <div *ngIf="personalDetails.get('dateOfBirth')?.touched && personalDetails.get('dateOfBirth')?.invalid" class="error-message">
      Please select a date.
    </div>
  </div>

  <div class="form-group required">
    <label for="cellphone">Cellphone</label>
    <input id="cellphone" type="tel" formControlName="cellphone" />
    <div *ngIf="personalDetails.get('cellphone')?.touched && personalDetails.get('cellphone')?.invalid" class="error-message">
      Please fill this field.
    </div>
  </div>

  <div class="form-group">
    <label for="businessPhone">Business Phone</label>
    <input id="businessPhone" type="tel" formControlName="businessPhone" />
  </div>

  <div class="form-group">
    <label for="homePhone">Home Phone</label>
    <input id="homePhone" type="tel" formControlName="homePhone" />
  </div>
</div>

      <br>
      <!-- Gender -->
      <div class="form-group required">
        <label class="highlight-label">Gender</label>
        <div class="radio-group">
          <div class="radio-item">
            <input type="radio" id="gender-male" value="MALE" formControlName="gender" />
            <label for="gender-male">Male</label>
          </div>
          <div class="radio-item">
            <input type="radio" id="gender-female" value="FEMALE" formControlName="gender" />
            <label for="gender-female">Female</label>
          </div>
        </div>
        <div *ngIf="personalDetails.get('gender')?.touched && personalDetails.get('gender')?.invalid" class="error-message">
          Please select an option.
        </div>
      </div>
      <br>
      <!-- Co-Applicant -->
      <div class="form-group required">
        <label class="highlight-label">Add Co-Applicant</label>
        <div class="radio-group">
          <div class="radio-item">
            <input type="radio" id="coapp-yes" value="YES" formControlName="addCoApplicant" />
            <label for="coapp-yes">Yes</label>
          </div>
          <div class="radio-item">
            <input type="radio" id="coapp-no" value="NO" formControlName="addCoApplicant" />
            <label for="coapp-no">No</label>
          </div>
        </div>
        <div *ngIf="personalDetails.get('addCoApplicant')?.touched && personalDetails.get('addCoApplicant')?.invalid" class="error-message">
          Please select an option.
        </div>
      </div>
    </div>

    <!-- Business Information -->
    <div class="form-section" formGroupName="businessInformation">
      <h2>Business Information for proposed Location</h2>

      <div class="form-row row-4">
        <div class="form-group required">
          <label for="businessName">Business Name</label>
          <input id="businessName" type="text" formControlName="businessName" />
          <div *ngIf="businessInformation.get('businessName')?.touched && businessInformation.get('businessName')?.invalid" class="error-message">
            Please fill this field.
          </div>
        </div>

        <div class="form-group">
          <label for="typeOfBusiness">Type of Business</label>
          <input id="typeOfBusiness" type="text" formControlName="typeOfBusiness" />
        </div>

        <div class="form-group required">
          <label for="country">Country</label>
          <select id="country" formControlName="country">
            <option value="">Select...</option>
            <option *ngFor="let c of lookupData.countryCode" [value]="c.key">{{ c.value }}</option>
          </select>
          <div *ngIf="businessInformation.get('country')?.touched && businessInformation.get('country')?.invalid" class="error-message">
            Please select an option.
          </div>
        </div>

        <div class="form-group required">
          <label for="parish">Parish</label>
          <select id="parish" formControlName="parish">
            <option value="">Select...</option>
            <option *ngFor="let p of lookupData.parishCounty" [value]="p.key">{{ p.key }} ({{ p.value }})</option>
          </select>
          <div *ngIf="businessInformation.get('parish')?.touched && businessInformation.get('parish')?.invalid" class="error-message">
            Please select an option.
          </div>
        </div>
      </div>
      <br>
      <div class="form-row row-4">
        <div class="form-group">
          <label for="town">Town</label>
          <input id="town" type="text" formControlName="town" />
        </div>
        <div class="form-group">
          <label for="district">District</label>
          <input id="district" type="text" formControlName="district" />
        </div>
        <div class="form-group">
          <label for="postalCode">Postal Code</label>
          <input id="postalCode" type="text" formControlName="postalCode" />
        </div>
        <div class="form-group required">
          <label for="address">Address</label>
          <textarea id="address" formControlName="address"></textarea>
          <div *ngIf="businessInformation.get('address')?.touched && businessInformation.get('address')?.invalid" class="error-message">
            Please fill this field.
          </div>
        </div>
      </div>
      <br>
      <div class="form-row years-months">
        <div class="left-section">
          <div class="form-group required">
            <label class="highlight-label">Do you own the business?</label>
            <div class="radio-group">
              <div class="radio-item">
                <input type="radio" id="own-business-yes" value="YES" formControlName="doYouOwnBusiness" />
                <label for="own-business-yes">Yes</label>
              </div>
              <div class="radio-item">
                <input type="radio" id="own-business-no" value="NO" formControlName="doYouOwnBusiness" />
                <label for="own-business-no">No</label>
              </div>
            </div>
            <div *ngIf="businessInformation.get('doYouOwnBusiness')?.touched && businessInformation.get('doYouOwnBusiness')?.invalid" class="error-message">
              Please select an option.
            </div>
          </div>
        </div>

        <div class="right-section">
          <div class="form-group required">
            <label for="yearsInOperation">Years in Operation</label>
            <input id="yearsInOperation" type="number" formControlName="yearsInOperation" min="0" />
            <div *ngIf="businessInformation.get('yearsInOperation')?.touched && businessInformation.get('yearsInOperation')?.invalid" class="error-message">
              Please fill this field.
            </div>
          </div>

          <div class="form-group required">
            <label for="monthsInOperation">Months in Operation</label>
            <input id="monthsInOperation" type="number" formControlName="monthsInOperation" min="0" />
            <div *ngIf="businessInformation.get('monthsInOperation')?.touched && businessInformation.get('monthsInOperation')?.invalid" class="error-message">
              Please fill this field.
            </div>
          </div>
        </div>
      </div>

      <div class="form-group required">
        <label class="highlight-label">Do you own or rent the location?</label>
        <div class="radio-group">
          <div class="radio-item">
            <input type="radio" id="own-location" value="OWN" formControlName="ownOrRentLocation" />
            <label for="own-location">Own</label>
          </div>
          <div class="radio-item">
            <input type="radio" id="rent-location" value="RENT" formControlName="ownOrRentLocation" />
            <label for="rent-location">Rent</label>
          </div>
        </div>
        <div *ngIf="businessInformation.get('ownOrRentLocation')?.touched && businessInformation.get('ownOrRentLocation')?.invalid" class="error-message">
          Please select an option.
        </div>
      </div>
    </div>

 
<!-- File Upload -->
<div class="form-section">
  <div
    class="file-upload-box"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    (click)="fileInput.click()"
    [class.disabled]="uploadedFiles.length >= 10"
    #fileDropZone
  >
    <i class="fa fa-cloud-upload upload-icon"></i>
    <p *ngIf="uploadedFiles.length < 10">
      Drag & Drop to upload files or 
      <a href="#" (click)="$event.preventDefault()">Browse</a>
    </p>
    <p *ngIf="uploadedFiles.length >= 10" class="upload-limit-message">
      Maximum of 10 files uploaded. Remove a file to add more.
    </p>
  </div>

  <!-- Note moved outside -->
  <small class="upload-note">
    Supports max 10 files, 10MB each. Formats: jpg, png, pdf, docx.
  </small>
</div>

  <!-- Hidden File Input -->
  <input 
    type="file" 
    id="uploadDocuments" 
    (change)="onFileSelected($event)" 
    #fileInput 
    [disabled]="uploadedFiles.length >= 10"
    multiple
    style="display: none;" 
  />

  <!-- Uploaded File List -->
  <div class="uploaded-files">
    <div *ngFor="let file of uploadedFiles; let i = index" class="uploaded-file">
      <span class="file-name">{{ file.name }}</span>
      <button type="button" class="view-btn" (click)="viewFile(file)">👁</button>
      <button type="button" class="remove-btn" (click)="removeFile(i)">✖</button>
    </div>

    <!-- Error Message -->
    <div *ngIf="uploadError" class="upload-error">
      {{ uploadError }}
    </div>
  </div>



    <!-- Buttons -->
<div class="button-group">
  <button type="button" class="btn btn-cancel" (click)="backToEdit()">Cancel</button>

  <!-- If not in review mode, first Create enters review -->
  <button *ngIf="!reviewMode" type="button" class="btn btn-create" (click)="enterReviewMode()">
    Create
  </button>

  <!-- If in review mode, Create opens modal -->
  <button *ngIf="reviewMode" type="button" class="btn btn-create" (click)="openModal()">
    Create
  </button>
</div>
  </form>
</div>

<!-- Modal -->
<div class="modal-overlay" *ngIf="isModalVisible">
  <div class="custom-modal">
    
    
      <p>Are you sure you want to submit this form?</p>
    
    
      <button class="btn-cancel" (click)="closeModal()">Cancel</button>
      <button class="btn-confirm" (click)="onConfirm()">Confirm</button>
    
  </div>
</div>
